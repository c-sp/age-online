(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{RGeJ:function(t,e,n){"use strict";n.r(e),n.d(e,"createEmulationFactory",(function(){return k})),n.d(e,"createRomArchive",(function(){return J}));var r=n("D57K"),o=n("s5Av"),i=n("snle"),s=n("DwTn"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(s.a),c=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parent=e,o.outerValue=n,o.outerIndex=r,o.index=0,o}return r.__extends(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(s.a),u=n("FGAU"),l=n("HnWI");function h(t,e,n,r,o){if(void 0===o&&(o=new c(t,n,r)),!o.closed)return e instanceof l.a?e.subscribe(o):Object(u.a)(e)(o)}var d=n("sna8"),p={};function f(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=void 0,r=void 0;return Object(o.a)(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&Object(i.a)(t[0])&&(t=t[0]),Object(d.a)(t,r).lift(new m(n))}var m=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new b(t,this.resultSelector))},t}(),b=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return r.__extends(e,t),e.prototype._next=function(t){this.values.push(p),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(h(this,r,void 0,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var r=this.values,o=r[n],i=this.toRespond?o===p?--this.toRespond:this.toRespond:0;r[n]=e,0===i&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)},e}(a),w=n("iJR/"),v=n("LR82");function _(t,e){void 0===e&&(e={});var n=e.selector,o=r.__rest(e,["selector"]);return new l.a((function(e){var i,s=new AbortController,a=s.signal,c=!0,u=!1,l=new v.a;if(l.add((function(){u=!0,c&&s.abort()})),o){if(o.signal)if(o.signal.aborted)s.abort();else{var h=o.signal,d=function(){a.aborted||s.abort()};h.addEventListener("abort",d),l.add((function(){return h.removeEventListener("abort",d)}))}i=r.__assign({},o,{signal:a})}else i={signal:a};return fetch(t,i).then((function(t){n?l.add(Object(w.a)(n(t)).subscribe((function(t){return e.next(t)}),(function(t){c=!1,u||e.error(t)}),(function(){c=!1,e.complete()}))):(c=!1,e.next(t),e.complete())})).catch((function(t){c=!1,u||e.error(t)})),l}))}var x=n("IMYO"),g=n("AouM"),y=n("AqJ0"),O=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}(),E=n("d9YI");var j=function(){function t(t){if(this.total=t,this.total<0)throw new O}return t.prototype.call=function(t,e){return e.subscribe(new I(t,this.total))},t}(),I=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return r.__extends(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(s.a),R=n("Jg5f");class A{constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("could not create canvas 2d rendering context");this.canvasCtx=e}newFrame(t){const e=new ImageData(t,160,144),{canvas:n,canvasCtx:r}=this;160!==n.width&&(n.width=160),144!==n.height&&(n.height=144),r.putImageData(e,0,0)}}class D{constructor(t,e){this.wasmInstance=t,this.cartridge=e,this.pauseEmulation=!1,this.emulatedMillis=0;const n=new Uint8Array(e.romData),r=t._gb_allocate_rom_buffer(n.length);t.HEAPU8.set(n,r),t._gb_new_emulator(),this.cyclesPerSecond=t._gb_get_cycles_per_second()}startEmulation(t){this.stopEmulation(),this.renderer=new A(t),this.requestAnimationFrame()}stopEmulation(){const{animationRequestHandle:t}=this;t&&(cancelAnimationFrame(t),this.renderer=void 0,this.animationRequestHandle=void 0,this.lastTimestamp=void 0)}requestAnimationFrame(){this.animationRequestHandle=requestAnimationFrame(t=>this.runEmulation(t))}runEmulation(t){const{pauseEmulation:e,lastTimestamp:n,cyclesPerSecond:r,wasmInstance:o,renderer:i}=this;if(n&&!e){const e=Math.min(33,t-n),s=this.emulatedMillis+=e,a=Math.floor(s*r/1e3)-o._gb_get_emulated_cycles();if(a>0){if(o._gb_emulate(a,48e3)){const t=o._gb_get_screen_front_buffer(),e=new Uint8ClampedArray(o.HEAPU8.buffer,t,92160);null==i||i.newFrame(e)}}}this.lastTimestamp=t,this.requestAnimationFrame()}buttonDown(t){this.wasmInstance._gb_set_buttons_down(t)}buttonUp(t){this.wasmInstance._gb_set_buttons_up(t)}}var $=n("4xKp"),B=n("WE1E");class C{constructor(t,e){var n;this.ageWasmInstance$=f([Object(w.a)(import(t)).pipe(Object(x.a)(t=>{throw new $.a(t)})),_(e).pipe(Object(g.a)(t=>{if(t.ok)return Object(w.a)(t.arrayBuffer());throw new $.a}),Object(x.a)(t=>{throw new $.a(t)}))]).pipe(Object(y.a)(1),(n=1,function(t){return 0===n?Object(E.a)():t.lift(new j(n))}),Object(g.a)(([t,e])=>Object(w.a)(t.default({wasmBinary:e})).pipe(Object(x.a)(t=>{throw new $.b(t)}),Object(R.a)(t=>{if(!t)throw new $.b;return t}))))}newEmulation$(t){return f([this.ageWasmInstance$,Object(B.b)(t)]).pipe(Object(R.a)(([t,e])=>new D(t,e)))}}class S extends Error{constructor(t){super("could not open IndexedDB"),this.domException=t}}class F extends Error{constructor(){super("IndexedDB blocked by different instance")}}class T extends Error{constructor(){super("IndexedDB error")}}class q extends Error{constructor(){super("IndexedDB version changed by different instance")}}class H{constructor(t){var e;this.archiveName=t,this.indexedDB$=(e=t,new l.a(t=>{const n=indexedDB.open(e,1);n.onerror=()=>t.error(new S(n.error)),n.onblocked=()=>t.error(new F),n.onsuccess=()=>{const{result:e}=n;t.next(e),e.onerror=()=>{e.close(),t.error(new T)},e.onversionchange=()=>{e.close(),t.error(new q)}},n.onupgradeneeded=t=>{const{oldVersion:e}=t,{result:r}=n;if(e<=1){const t=r.createObjectStore("rom-archive",{keyPath:"romHash"});t.createIndex("romCustomTitleIdx","romCustomTitle"),t.createIndex("romInternalTitleIdx","romInternalTitle")}}})).pipe(Object(y.a)(1))}readRomList$(){return this.indexedDB$.pipe(Object(R.a)(()=>[]))}readRom$(){return this.indexedDB$.pipe(Object(R.a)(()=>null))}addRom$(){return this.indexedDB$.pipe(Object(R.a)(()=>{throw new Error("addRom$ not implemented")}))}updateRomTitle$(){return this.indexedDB$.pipe(Object(R.a)(()=>null))}}function k(t,e){return new C(t,e)}function J(t){return function(t){return new H(t)}(t)}}}]);